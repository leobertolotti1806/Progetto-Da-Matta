import{g as d,_ as f}from"./qEfkgdYJ.js";import{_}from"./Jb0QBs_6.js";import{Q as y}from"./BtZzEF0O.js";import{_ as k,I as b,C as w,r,o as q,t as g,z as I,D as h,F as i,x as a,B as p,H as z,v as u}from"./CX_hZqBa.js";const E=window.setInterval,R={key:0},x={class:"container"},C={class:"qr-wrapper"},M=["src"],S=["href"],A={__name:"satispay",setup(D){const l=b(),e=w({title:"",msg:"",link:"",linkMsg:""}),o=r(!1),c=r(null),m=r(null);return r(null),o.value=!1,d("https://bertolotti.ct.ws/getPayment").then(function(s){if(!s.ok)o.value=!0,e.msg=s.msg,s.tryAgain&&(e.link="/iscrizione?id="+l.query.id,e.linkMsg="Riprova qui!");else if(s.paymentAccepted)o.value=!0,e.title="Ottimo!",e.msg=s.msg;else{const t="https://www.satispay.com/download/qrcode/"+s.codeIdentifier;y.toDataURL(t).then(n=>{c.value=n}).catch(n=>{console.error("Errore nella generazione del qr code : ",n)}),m.value=t}}),q(()=>{if(!o.value){const s=E(async function(){o.value&&clearInterval(s);let t=await d("https://bertolotti.ct.ws/checkPayment");t.ok?t.status==="ACCEPTED"?(clearInterval(s),o.value=!0,e.msg=`Pagamento avvenuto con successo!
È stato riservato un posto per te!`,e.title="Ottimo!"):(t.status==="CANCELED"||t.status==="EXPIRED")&&(clearInterval(s),o.value=!0,e.title="Mancava poco!",e.msg="Il pagamento è scaduto, riprova a rifarlo. (non è stato addebitato nulla)",t.tryAgain&&(e.link="/iscrizione?id="+l.query.id,e.linkMsg="Riprova qui!")):(clearInterval(s),o.value=!0,e.msg=t.msg,e.link="/iscrizione?id="+l.query.id,e.linkMsg="Riprova ad iscriverti")},3e3)}}),(s,t)=>{const n=f,v=_;return u(),g(z,null,[I(n,{show:!i(o)&&!i(c)},null,8,["show"]),i(o)?(u(),h(v,{key:1,obj:i(e)},null,8,["obj"])):(u(),g("main",R,[a("div",x,[t[1]||(t[1]=a("h1",null,"Paga con Satispay",-1)),t[2]||(t[2]=a("p",{class:"subtitle"},[p(" Manca poco per poter completare l'iscrizione! "),a("br"),a("br"),p(" Scansiona il QR code o clicca sul link per procedere: ")],-1)),a("div",C,[a("img",{src:i(c),alt:"QR Code Satispay, se vedi questa scritta usa il link sotto per pagare",class:"qr-img"},null,8,M)]),a("a",{href:i(m),target:"_blank",class:"btn-satispay"},t[0]||(t[0]=[p(" Apri in Satispay "),a("img",{src:"https://bertolotti.ct.ws/satispay.jpg",alt:"Satispay logo"},null,-1)]),8,S),t[3]||(t[3]=a("p",{class:"info"},"Se non riesci ad aprire satispay dal bottone, scannerizza il codice Qr con l'app.",-1)),t[4]||(t[4]=a("p",{class:"info"},"Se ritorni su questa pagina dopo il pagamento avrai una conferma dell'iscrizione.",-1))])]))],64)}}},L=k(A,[["__scopeId","data-v-4a17945d"]]);export{L as default};
